<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Статус сайта — Админка</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    .modal-bg {
      background-color: rgba(0, 0, 0, 0.5);
    }
    .tab-content > div {
      display: none;
    }
    .tab-content > div.active {
      display: block;
    }
    .tab-btn.active {
      border-bottom: 3px solid #4f46e5;
      font-weight: 600;
      color: #4f46e5;
    }
    /* Toast уведомления */
    #toastContainer {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      z-index: 60;
      max-width: 320px;
    }
    .toast {
      background: #4f46e5;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 8px rgba(79,70,229,0.3);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: fadein 0.5s, fadeout 0.5s 4.5s;
    }
    .toast.hide {
      display: none;
    }
    .toast button {
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1.2rem;
    }
    @keyframes fadein {
      from {opacity: 0; transform: translateX(50px);}
      to {opacity: 1; transform: translateX(0);}
    }
    @keyframes fadeout {
      from {opacity: 1;}
      to {opacity: 0;}
    }
    /* Системное сообщение */
    #systemMessageBar {
      background-color: #fde68a;
      color: #92400e;
      padding: 0.7rem 1rem;
      text-align: center;
      font-weight: 600;
      display: none;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Системное сообщение -->
  <div id="systemMessageBar"></div>

  <!-- Админ кнопка -->
  <button
    id="adminOpenBtn"
    title="Вход в админку"
    class="fixed top-4 right-4 z-50 bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-full shadow-lg transition"
  >
    <i class="fas fa-cog fa-lg"></i>
  </button>

  <!-- Модальное окно админки -->
  <div
    id="adminModal"
    class="modal-bg fixed inset-0 flex items-center justify-center hidden"
  >
    <div
      class="bg-white rounded-lg shadow-xl w-full max-w-3xl p-6 relative"
      role="dialog"
      aria-modal="true"
      aria-labelledby="adminTitle"
    >
      <button
        id="adminCloseBtn"
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
        title="Закрыть"
      >
        <i class="fas fa-times fa-lg"></i>
      </button>

      <h2
        id="adminTitle"
        class="text-2xl font-bold mb-4 flex items-center gap-2"
      >
        <i class="fas fa-tools text-indigo-600"></i> Панель администратора
      </h2>

      <!-- Ввод кода -->
      <div id="adminLoginSection">
        <p class="mb-2 text-gray-700">
          Введите пароль администратора для доступа к настройкам:
        </p>
        <input
          id="adminCodeInput"
          type="password"
          placeholder="Введите код доступа"
          class="w-full p-2 border rounded mb-4"
          autocomplete="off"
        />
        <button
          id="adminLoginBtn"
          class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded"
        >
          Войти
        </button>
        <p id="loginError" class="text-red-600 mt-2 hidden">Неверный код доступа!</p>
      </div>

      <!-- Основная админка -->
      <div id="adminPanel" class="hidden">
        <!-- Время обновления и комментарий -->
        <div
          id="lastUpdateInfo"
          class="mb-4 bg-indigo-50 border border-indigo-200 text-indigo-700 p-3 rounded"
        >
          <strong>Последнее обновление:</strong> <span id="lastUpdateText">-</span><br />
          <strong>Комментарий:</strong> <span id="adminCommentText">-</span>
        </div>

        <!-- Таб кнопки -->
        <div class="flex gap-4 mb-6 border-b border-gray-300">
          <button
            class="tab-btn py-2 px-4 cursor-pointer active text-indigo-600 border-b-2 border-indigo-600"
            data-tab="mainSettings"
          >
            Основные настройки
          </button>
          <button class="tab-btn py-2 px-4 cursor-pointer" data-tab="onlineStatus">
            Онлайн
          </button>
          <button class="tab-btn py-2 px-4 cursor-pointer" data-tab="serverSettings">
            Сам сервер
          </button>
          <button class="tab-btn py-2 px-4 cursor-pointer" data-tab="otherSettings">
            Другие
          </button>
        </div>

        <div class="tab-content">
          <!-- Основные настройки -->
          <div id="mainSettings" class="active space-y-4">
            <label class="flex items-center gap-3">
              <input type="checkbox" id="siteStatusToggle" />
              <span class="font-semibold text-gray-700">Сайт закрыт (технические работы)</span>
            </label>
            <label class="block">
              <span class="text-gray-700 font-semibold mb-1 block">Комментарий администратора</span>
              <textarea
                id="adminComment"
                rows="3"
                class="w-full p-2 border rounded"
                placeholder="Напишите комментарий для пользователей..."
              ></textarea>
            </label>
            <label class="block">
              <span class="text-gray-700 font-semibold mb-1 block">Системное сообщение (для всех пользователей)</span>
              <textarea
                id="systemMessage"
                rows="2"
                class="w-full p-2 border rounded"
                placeholder="Напишите сообщение, которое будет видно всем..."
              ></textarea>
            </label>
          </div>

          <!-- Онлайн -->
          <div id="onlineStatus" class="space-y-4">
            <p>Здесь будут статусы онлайн серверов (пока пусто)</p>
          </div>

          <!-- Сам сервер -->
          <div id="serverSettings" class="space-y-4">
            <p>Настройки сервера (пока пусто)</p>
          </div>

          <!-- Другие -->
          <div id="otherSettings" class="space-y-4">
            <p>Другие настройки (пока пусто)</p>
          </div>
        </div>

        <!-- История обновлений -->
        <div class="mt-8">
          <h3 class="text-lg font-semibold mb-2">История обновлений</h3>
          <ul id="historyList" class="max-h-40 overflow-y-auto border border-gray-300 rounded p-3 bg-white text-sm"></ul>
          <button
            id="clearHistoryBtn"
            class="mt-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded flex items-center gap-2"
          >
            <i class="fas fa-trash"></i> Очистить историю
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Контейнер для уведомлений toast -->
  <div id="toastContainer"></div>

  <script>
    // Хранение данных
    const STORAGE_KEYS = {
      SITE_CLOSED: "siteClosed",
      ADMIN_COMMENT: "adminComment",
      SYSTEM_MESSAGE: "systemMessage",
      HISTORY: "updateHistory",
    };

    // Кастомные уведомления (toast)
    function showToast(message) {
      const container = document.getElementById("toastContainer");
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.innerHTML = `
        <span>${message}</span>
        <button aria-label="Закрыть уведомление">&times;</button>
      `;

      const closeBtn = toast.querySelector("button");
      closeBtn.onclick = () => {
        toast.classList.add("hide");
        setTimeout(() => toast.remove(), 300);
      };

      container.appendChild(toast);

      setTimeout(() => {
        toast.classList.add("hide");
        setTimeout(() => toast.remove(), 300);
      }, 5000);
    }

    // Установка значений из localStorage в админку
    function loadAdminData() {
      const siteClosed = localStorage.getItem(STORAGE_KEYS.SITE_CLOSED) === "true";
      const adminComment = localStorage.getItem(STORAGE_KEYS.ADMIN_COMMENT) || "";
      const systemMessage = localStorage.getItem(STORAGE_KEYS.SYSTEM_MESSAGE) || "";

      document.getElementById("siteStatusToggle").checked = siteClosed;
      document.getElementById("adminComment").value = adminComment;
      document.getElementById("systemMessage").value = systemMessage;

      updateLastUpdateInfo();
      updateSystemMessageBar(systemMessage);
      renderHistory();
    }

    // Обновляем поле "Последнее обновление"
    function updateLastUpdateInfo() {
      const lastUpdate = localStorage.getItem("lastUpdate") || "-";
      const adminComment = localStorage.getItem(STORAGE_KEYS.ADMIN_COMMENT) || "-";
      document.getElementById("lastUpdateText").textContent = lastUpdate;
      document.getElementById("adminCommentText").textContent = adminComment;
    }

    // Обновляем системное сообщение вверху сайта
    function updateSystemMessageBar(msg) {
      const bar = document.getElementById("systemMessageBar");
      if (msg && msg.trim() !== "") {
        bar.textContent = msg;
        bar.style.display = "block";
      } else {
        bar.style.display = "none";
      }
    }

    // Добавляем запись в историю
    function addToHistory(status, comment) {
      const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.HISTORY) || "[]");
      const time = new Date().toLocaleString();
      history.unshift({ time, status, comment });
      if (history.length > 20) history.pop();
      localStorage.setItem(STORAGE_KEYS.HISTORY, JSON.stringify(history));
      renderHistory();
    }

    // Отрисовка истории
    function renderHistory() {
      const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.HISTORY) || "[]");
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      if (history.length === 0) {
        list.innerHTML = "<li class='text-gray-500'>История пустая</li>";
        return;
      }
      for (const item of history) {
        const li = document.createElement("li");
        li.textContent = `[${item.time}] Статус: ${
          item.status ? "Закрыт" : "Открыт"
        }, Комментарий: ${item.comment || "-"}`;
        list.appendChild(li);
      }
    }

    // Сохраняем изменения админки
    function saveAdminData() {
      const siteClosed = document.getElementById("siteStatusToggle").checked;
      const adminComment = document.getElementById("adminComment").value.trim();
      const systemMessage = document.getElementById("systemMessage").value.trim();

      localStorage.setItem(STORAGE_KEYS.SITE_CLOSED, siteClosed);
      localStorage.setItem(STORAGE_KEYS.ADMIN_COMMENT, adminComment);
      localStorage.setItem(STORAGE_KEYS.SYSTEM_MESSAGE, systemMessage);

      const now = new Date().toLocaleString();
      localStorage.setItem("lastUpdate", now);

      addToHistory(siteClosed, adminComment);

      updateLastUpdateInfo();
      updateSystemMessageBar(systemMessage);

      // Показываем toast уведомление для админа
      showToast(
        `Обновлено: сайт ${siteClosed ? "закрыт" : "открыт"}. Комментарий: ${adminComment ||
          "без комментария"}`
      );

      // Если сайт закрыт, обновим страницу (чтобы показать блок закрытия)
      checkSiteClosed();
    }

    // Проверка админ кода (пароля)
    const ADMIN_CODE = "1234"; // поменяй на свой

    // Элементы
    const adminOpenBtn = document.getElementById("adminOpenBtn");
    const adminModal = document.getElementById("adminModal");
    const adminCloseBtn = document.getElementById("adminCloseBtn");
    const adminLoginSection = document.getElementById("adminLoginSection");
    const adminPanel = document.getElementById("adminPanel");
    const adminCodeInput = document.getElementById("adminCodeInput");
    const adminLoginBtn = document.getElementById("adminLoginBtn");
    const loginError = document.getElementById("loginError");

    // Переключение табов
    document.querySelectorAll(".tab-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.dataset.tab;
        document.querySelectorAll(".tab-content > div").forEach((div) => {
          div.classList.remove("active");
        });
        document.getElementById(tab).classList.add("active");
      });
    });

    // Открыть админку
    adminOpenBtn.addEventListener("click", () => {
      adminModal.classList.remove("hidden");
      adminCodeInput.value = "";
      adminLoginSection.classList.remove("hidden");
      adminPanel.classList.add("hidden");
      loginError.classList.add("hidden");
      adminCodeInput.focus();
    });

    // Закрыть админку
    adminCloseBtn.addEventListener("click", () => {
      adminModal.classList.add("hidden");
    });

    // Вход в админку
    adminLoginBtn.addEventListener("click", () => {
      const code = adminCodeInput.value.trim();
      if (code === ADMIN_CODE) {
        adminLoginSection.classList.add("hidden");
        adminPanel.classList.remove("hidden");
        loadAdminData();
      } else {
        loginError.classList.remove("hidden");
      }
    });

    // Сохранять изменения при уходе из textarea и переключении чекбокса
    document.getElementById("siteStatusToggle").addEventListener("change", saveAdminData);
    document.getElementById("adminComment").addEventListener("blur", saveAdminData);
    document.getElementById("systemMessage").addEventListener("blur", saveAdminData);

    // Очистка истории
    document.getElementById("clearHistoryBtn").addEventListener("click", () => {
      if (confirm("Очистить историю обновлений?")) {
        localStorage.removeItem(STORAGE_KEYS.HISTORY);
        renderHistory();
        showToast("История обновлений очищена");
      }
    });

    // Показать уведомление в админке при загрузке страницы, если есть изменения
    window.addEventListener("load", () => {
      const lastUpdate = localStorage.getItem("lastUpdate");
      if (lastUpdate) {
        const siteClosed = localStorage.getItem(STORAGE_KEYS.SITE_CLOSED) === "true";
        const adminComment = localStorage.getItem(STORAGE_KEYS.ADMIN_COMMENT) || "";
        showToast(
          `Сайт сейчас ${siteClosed ? "закрыт" : "открыт"}. Комментарий: ${adminComment || "-"}`
        );
      }
      // Отобразить системное сообщение на сайте сразу
      updateSystemMessageBar(localStorage.getItem(STORAGE_KEYS.SYSTEM_MESSAGE) || "");

      // Проверить статус сайта (закрыт или нет)
      checkSiteClosed();
    });

    // Если сайт закрыт, можно показать на странице блок с сообщением (пример)
    function checkSiteClosed() {
      const closed = localStorage.getItem(STORAGE_KEYS.SITE_CLOSED) === "true";
      if (closed) {
        document.body.innerHTML = `
          <div class="flex items-center justify-center min-h-screen bg-gray-100 p-4 text-center">
            <div>
              <h1 class="text-3xl font-bold mb-4 text-indigo-700">Сайт временно закрыт</h1>
              <p class="mb-4 text-gray-700">${localStorage.getItem(STORAGE_KEYS.ADMIN_COMMENT) || "Технические работы"}</p>
            </div>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
