<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ú–µ—Ç—Ä–æ New Status</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #f9fafb;
    margin: 0; padding: 0;
    color: #24292e;
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header {
    background-color: #2c3e50;
    color: white;
    padding: 20px 40px;
    text-align: center;
    font-weight: 700;
    font-size: 24px;
    letter-spacing: 1.2px;
  }
  header span.status-text {
    display: block;
    font-weight: 400;
    font-size: 16px;
    margin-top: 4px;
    color: #a8c256; /* –∑–µ–ª–µ–Ω—ã–π */
  }
  main {
    flex: 1;
    max-width: 900px;
    margin: 40px auto;
    padding: 0 20px;
    width: 100%;
  }
  .service-card {
    background: #fff;
    padding: 20px 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: box-shadow 0.3s ease;
  }
  .service-card:hover {
    box-shadow: 0 4px 14px rgb(0 0 0 / 0.15);
  }
  .service-info {
    display: flex;
    flex-direction: column;
  }
  .service-name {
    font-weight: 700;
    font-size: 20px;
    margin-bottom: 6px;
  }
  .status-row {
    display: flex;
    align-items: center;
    font-size: 16px;
    color: #586069;
  }
  .status-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 12px;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  .status-online {
    background-color: #28a745;
    box-shadow: 0 0 8px #28a745;
  }
  .status-maintenance {
    background-color: #dbab09;
    box-shadow: 0 0 8px #dbab09;
  }
  .status-offline {
    background-color: #d73a49;
    box-shadow: 0 0 8px #d73a49;
  }
  button.open-button {
    padding: 10px 24px;
    background: #0366d6;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: background 0.25s ease;
    box-shadow: 0 2px 6px rgb(3 102 214 / 0.4);
  }
  button.open-button:hover {
    background: #024fa2;
    box-shadow: 0 3px 9px rgb(2 79 162 / 0.7);
  }
  footer {
    background: #f0f0f0;
    color: #666;
    text-align: center;
    padding: 16px 10px;
    font-size: 14px;
    user-select: none;
  }
  @media (max-width: 600px) {
    .service-card {
      flex-direction: column;
      align-items: flex-start;
    }
    button.open-button {
      margin-top: 12px;
      width: 100%;
    }
  }
  /* --- –ê–¥–º–∏–Ω–∫–∞ --- */
  #adminPanel {
    background: #fff;
    padding: 20px 30px;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
    max-width: 500px;
    margin: 20px auto;
  }
  #adminPanel h2 {
    margin-top: 0;
    text-align: center;
    color: #2c3e50;
  }
  #adminPanel label {
    display: block;
    margin: 15px 0 6px 0;
    font-weight: 600;
  }
  #adminPanel select {
    width: 100%;
    padding: 8px 10px;
    font-size: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  #adminPanel button {
    margin-top: 20px;
    width: 100%;
  }
  #loginForm {
    max-width: 320px;
    margin: 30px auto;
    background: white;
    padding: 20px 25px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  #loginForm input[type="password"] {
    width: 100%;
    padding: 10px 14px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  #loginForm button {
    margin-top: 15px;
    width: 100%;
  }
  #loginError {
    color: #d73a49;
    margin-top: 10px;
    text-align: center;
    font-weight: 600;
  }
</style>
</head>
<body>

<header>
  –ú–µ—Ç—Ä–æ New Status
  <span id="overallStatus" class="status-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤...</span>
</header>

<main>
  <div id="statusList">
    <!-- –°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—é–¥–∞ -->
  </div>

  <div id="loginForm">
    <h2>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h2>
    <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" />
    <button id="loginBtn">–í–æ–π—Ç–∏</button>
    <div id="loginError"></div>
  </div>

  <div id="adminPanel" style="display:none;">
    <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
    <form id="statusForm">
      <!-- –°–µ–ª–µ–∫—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </form>
    <button id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã</button>
  </div>
</main>

<footer>
  ¬© 2025 –ú–µ—Ç—Ä–æ New. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
</footer>

<script>
  const statusListEl = document.getElementById('statusList');
  const overallStatusEl = document.getElementById('overallStatus');
  const loginFormEl = document.getElementById('loginForm');
  const adminPanelEl = document.getElementById('adminPanel');
  const statusFormEl = document.getElementById('statusForm');
  const loginBtn = document.getElementById('loginBtn');
  const adminPasswordInput = document.getElementById('adminPassword');
  const loginErrorEl = document.getElementById('loginError');
  const saveBtn = document.getElementById('saveBtn');

  let statuses = {};
  let isAdmin = false;

  const statusTextMap = {
    online: ['üü¢', 'Online'],
    maintenance: ['üü°', '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã'],
    offline: ['üî¥', '–ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω'],
  };

  const statusClassMap = {
    online: 'status-online',
    maintenance: 'status-maintenance',
    offline: 'status-offline',
  };

  async function fetchStatuses() {
    try {
      const res = await fetch('/api/statuses');
      statuses = await res.json();
      renderStatuses();
      renderOverallStatus();
      if(isAdmin) renderAdminForm();
    } catch (e) {
      overallStatusEl.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤';
      console.error(e);
    }
  }

  function renderStatuses() {
    statusListEl.innerHTML = '';
    for (const key in statuses) {
      const s = statuses[key];
      const card = document.createElement('div');
      card.className = 'service-card';

      const info = document.createElement('div');
      info.className = 'service-info';

      const nameEl = document.createElement('div');
      nameEl.className = 'service-name';
      nameEl.textContent = s.name;

      const statusRow = document.createElement('div');
      statusRow.className = 'status-row';

      const dot = document.createElement('span');
      dot.className = `status-dot ${statusClassMap[s.status] || 'status-offline'}`;

      const text = document.createElement('span');
      text.textContent = statusTextMap[s.status]?.[1] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

      statusRow.appendChild(dot);
      statusRow.appendChild(text);

      info.appendChild(nameEl);
      info.appendChild(statusRow);

      const btn = document.createElement('button');
      btn.className = 'open-button';
      btn.textContent = '–û—Ç–∫—Ä—ã—Ç—å';

      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
      const urlMap = {
        discord: 'https://discord.com',
        roblox: 'https://www.roblox.com',
        youtube: 'https://www.youtube.com',
        telegram: 'https://telegram.org',
        site: '/',
      };
      btn.onclick = () => window.open(urlMap[key] || '/', '_blank');

      card.appendChild(info);
      card.appendChild(btn);

      statusListEl.appendChild(card);
    }
  }

  // –í–∏–∑—É–∞–ª—å–Ω—ã–π –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å: –µ—Å–ª–∏ –≤—Å–µ online - –∑–µ–ª–µ–Ω—ã–π, –µ—Å–ª–∏ –µ—Å—Ç—å maintenance - –∂–µ–ª—Ç—ã–π, –µ—Å–ª–∏ –µ—Å—Ç—å offline - –∫—Ä–∞—Å–Ω—ã–π
  function renderOverallStatus() {
    let hasOffline = false, hasMaintenance = false;
    for (const s of Object.values(statuses)) {
      if (s.status === 'offline') hasOffline = true;
      else if (s.status === 'maintenance') hasMaintenance = true;
    }
    if(hasOffline) {
      overallStatusEl.textContent = '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã';
      overallStatusEl.style.color = '#d73a49'; // –∫—Ä–∞—Å–Ω—ã–π
    } else if(hasMaintenance) {
      overallStatusEl.textContent = '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç–∞—Ö';
      overallStatusEl.style.color = '#dbab09'; // –∂–µ–ª—Ç—ã–π
    } else {
      overallStatusEl.textContent = '–í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ';
      overallStatusEl.style.color = '#28a745'; // –∑–µ–ª–µ–Ω—ã–π
    }
  }

  // --- –ê–¥–º–∏–Ω–∫–∞ ---

  loginBtn.onclick = async () => {
    const password = adminPasswordInput.value.trim();
    if(!password) {
      loginErrorEl.textContent = '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å';
      return;
    }
    loginErrorEl.textContent = '';

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å –Ω–∞ –±—ç–∫–µ–Ω–¥–µ: –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π update —Å –ø–∞—Ä–æ–ª–µ–º
    try {
      const res = await fetch('/api/statuses/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password, updates: {} })
      });
      if(res.status === 403) {
        loginErrorEl.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
        return;
      }
      if(!res.ok) {
        loginErrorEl.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–∞—Ä–æ–ª—è';
        return;
      }
      isAdmin = true;
      loginFormEl.style.display = 'none';
      adminPanelEl.style.display = 'block';
      adminPasswordInput.value = '';
      renderAdminForm();
    } catch(e) {
      loginErrorEl.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–∞—Ä–æ–ª—è';
      console.error(e);
    }
  };

  function renderAdminForm() {
    statusFormEl.innerHTML = '';
    for (const key in statuses) {
      const s = statuses[key];
      const label = document.createElement('label');
      label.textContent = s.name;

      const select = document.createElement('select');
      select.name = key;
      ['online', 'maintenance', 'offline'].forEach(st => {
        const option = document.createElement('option');
        option.value = st;
        option.textContent = statusTextMap[st][1];
        if(st === s.status) option.selected = true;
        select.appendChild(option);
      });

      statusFormEl.appendChild(label);
      statusFormEl.appendChild(select);
    }
  }

  saveBtn.onclick = async () => {
    const formData = new FormData(statusFormEl);
    let updates = {};
    for (const [key, val] of formData.entries()) {
      updates[key] = val;
    }
    // –ü–∞—Ä–æ–ª—å –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≥–¥–µ-—Ç–æ, –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã - —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ
    let password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
    if(!password) {
      alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
      return;
    }

    try {
      const res = await fetch('/api/statuses/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password, updates })
      });
      if(res.status === 403) {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
        return;
      }
      if(!res.ok) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
        return;
      }
      const data = await res.json();
      statuses = data.statuses;
      renderStatuses();
      renderOverallStatus();
      renderAdminForm();
      alert('–°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
    } catch(e) {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
      console.error(e);
    }
  };

  // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
  fetchStatuses();
  setInterval(fetchStatuses, 10000);
</script>

</body>
</html>
